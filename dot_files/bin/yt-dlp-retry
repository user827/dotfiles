#!/bin/sh
set -eu

trap 'echo "got sigint"; exit 0' INT

if [ -z "${is_sleep_inhibited:-}" ]; then
  export is_sleep_inhibited=1
  exec gnome-session-inhibit --app-id yt-dlp-retry --reason dling --inhibit suspend "$0" "$@"
fi

while true; do
  yt-dlp ${YT_DLP_RETRY_ARGS:-} --socket-timeout 5 "$@" || true
  echo sleeping
  sleep 60
done
