#!/bin/sh
set -eu

if [ -z "${is_sleep_inhibited:-}" ]; then
  export is_sleep_inhibited=1
  exec gnome-session-inhibit --app-id yt-dlp-retry --reason dling --inhibit suspend "$0" "$@"
fi

for _try in $(seq 20); do
  yt-dlp "$@" || true
  echo sleeping
  sleep $((5*60))
done
